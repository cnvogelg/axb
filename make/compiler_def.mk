# compile.mk

BUILD_DIR = BUILD/$(AXB_PROJECT)

# --- VBCC ---
VBCC_BIN = vc
VBCC_CFLAGS_DEBUG = -g
VBCC_CFLAGS_OPT = -O2
VBCC_LDFLAGS_DEBUG = -g
VBCC_LIBS = -lamiga
VBCC_EXT = vbcc

# --- GCC ---
GCC_BIN = m68k-amigaos-gcc
GCC_CFLAGS = -noixemul
GCC_CFLAGS_DEBUG = -g
GCC_CFLAGS_OPT = -O2
GCC_LDFLAGS = -noixemul
GCC_LDFLAGS_DEBUG = -g
GCC_EXT = gcc

# --- AROS_GCC ---
AROS_GCC_BIN = m68k-aros-gcc
AROS_GCC_CFLAGS_DEBUG = -g
AROS_GCC_CFLAGS_OPT = -O2
AROS_GCC_LDFLAGS_DEBUG = -g
AROS_GCC_EXT = agcc

# --- SASC ---
SASC_INSTALL_DIR ?= $(HOME)/amiga/shared/sc
SASC_VAMOSRC = $(AXB_TOP)/sasc.vamosrc
SASC_BIN = vamos -c $(SASC_VAMOSRC) sc
SASC_CFLAGS = SMALLDATA SMALLCODE NOSTKCHK NOCHKABORT NOICONS STRICT ANSI
SASC_CFLAGS_OPT = PARAMETERS=REGISTERS OPT OPTTIME OPTINLINE\
            OPTSCHEDULE STRINGMERGE STRUCTUREEQUIVALENCE NODEBUG
SASC_CFLAGS_DEBUG = DEBUG=F
SASC_EXT = sasc

# common
DBG_EXT = _dbg

# derive build dirs
VBCC_BUILD_DIR_OPT = $(BUILD_DIR)/$(VBCC_EXT)
VBCC_BUILD_DIR_DEBUG = $(BUILD_DIR)/$(VBCC_EXT)$(DBG_EXT)
GCC_BUILD_DIR_OPT = $(BUILD_DIR)/$(GCC_EXT)
GCC_BUILD_DIR_DEBUG = $(BUILD_DIR)/$(GCC_EXT)$(DBG_EXT)
AROS_GCC_BUILD_DIR_OPT = $(BUILD_DIR)/$(AROS_GCC_EXT)
AROS_GCC_BUILD_DIR_DEBUG = $(BUILD_DIR)/$(AROS_GCC_EXT)$(DBG_EXT)
SASC_BUILD_DIR_OPT = $(BUILD_DIR)/$(SASC_EXT)
SASC_BUILD_DIR_DEBUG = $(BUILD_DIR)/$(SASC_EXT)$(DBG_EXT)

# all build dirs
ALL_BUILD_DIRS_OPT = $(patsubst %,$(BUILD_DIR)/%,$(foreach comp,$(AXB_COMPILERS),$($(comp)_EXT)))
ALL_BUILD_DIRS_DEBUG = $(patsubst %,$(BUILD_DIR)/%,$(foreach comp,$(AXB_COMPILERS),$($(comp)_EXT)$(DBG_EXT)))
ALL_BUILD_DIRS = $(foreach var,$(AXB_VARIANTS),$(ALL_BUILD_DIRS_$(var)))

# build c object files
VBCC_C_OBJS_OPT = $(patsubst %.c,$(VBCC_BUILD_DIR_OPT)/%.o,$(AXB_C_SRCS))
VBCC_C_OBJS_DEBUG = $(patsubst %.c,$(VBCC_BUILD_DIR_DEBUG)/%.o,$(AXB_C_SRCS))
GCC_C_OBJS_OPT = $(patsubst %.c,$(GCC_BUILD_DIR_OPT)/%.o,$(AXB_C_SRCS))
GCC_C_OBJS_DEBUG = $(patsubst %.c,$(GCC_BUILD_DIR_DEBUG)/%.o,$(AXB_C_SRCS))
AROS_GCC_C_OBJS_OPT = $(patsubst %.c,$(AROS_GCC_BUILD_DIR_OPT)/%.o,$(AXB_C_SRCS))
AROS_GCC_C_OBJS_DEBUG = $(patsubst %.c,$(AROS_GCC_BUILD_DIR_DEBUG)/%.o,$(AXB_C_SRCS))
SASC_C_OBJS_OPT = $(patsubst %.c,$(SASC_BUILD_DIR_OPT)/%.o,$(AXB_C_SRCS))
SASC_C_OBJS_DEBUG = $(patsubst %.c,$(SASC_BUILD_DIR_DEBUG)/%.o,$(AXB_C_SRCS))

# combine for selected compilers
ALL_C_OBJS_OPT = $(foreach comp,$(AXB_COMPILERS),$($(comp)_C_OBJS_OPT))
ALL_C_OBJS_DEBUG = $(foreach comp,$(AXB_COMPILERS),$($(comp)_C_OBJS_DEBUG))
ALL_C_OBJS = $(foreach var,$(AXB_VARIANTS),$(ALL_C_OBJS_$(var)))

# target files
VBCC_TARGET_OPT = $(VBCC_BUILD_DIR_OPT)/$(AXB_TARGET)
VBCC_TARGET_DEBUG = $(VBCC_BUILD_DIR_DEBUG)/$(AXB_TARGET)
GCC_TARGET_OPT = $(GCC_BUILD_DIR_OPT)/$(AXB_TARGET)
GCC_TARGET_DEBUG = $(GCC_BUILD_DIR_DEBUG)/$(AXB_TARGET)
AROS_GCC_TARGET_OPT = $(AROS_GCC_BUILD_DIR_OPT)/$(AXB_TARGET)
AROS_GCC_TARGET_DEBUG = $(AROS_GCC_BUILD_DIR_DEBUG)/$(AXB_TARGET)
SASC_TARGET_OPT = $(SASC_BUILD_DIR_OPT)/$(AXB_TARGET)
SASC_TARGET_DEBUG = $(SASC_BUILD_DIR_DEBUG)/$(AXB_TARGET)

# combine targets
ALL_TARGETS_OPT = $(foreach comp,$(AXB_COMPILERS),$($(comp)_TARGET_OPT))
ALL_TARGETS_DEBUG = $(foreach comp,$(AXB_COMPILERS),$($(comp)_TARGET_DEBUG))
ALL_TARGETS = $(foreach var,$(AXB_VARIANTS),$(ALL_TARGETS_$(var)))
